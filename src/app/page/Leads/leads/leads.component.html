
<app-leadtable-header-features 
(addLeadClicked)="togglePreviewRow()"
(searchLeads)="filterLeads($event)" 
></app-leadtable-header-features>

<!-- Dropdown view for available lead sources -->


<div *ngIf="showPreviewRow" class="mt-8 mx-8">

  <div class="overflow-x-auto rounded-2xl shadow-md">
    <table class="min-w-full bg-white border border-gray-300">
    
      <tbody *ngIf="leadSources.length > 0; else noData">
        <tr *ngFor="let source of leadSources" class="border-t border-gray-200 hover:bg-gray-50 transition duration-200">

          <td class="px-6 py-2">{{ source.leadName }}</td>
          <td class="px-6 py-2">{{ source.leadEmail }}</td>
          <td class="px-6 py-2">{{ source.contactNo }}</td>
          <td class="px-6 py-2">{{ source.companyName }}</td>
          <td class="px-6 py-2">{{ source.companyAdd }}</td>
          <td class="px-6 py-2">{{ source.sourceType }}</td>
          <td class="px-6 py-2">{{ source.crmService?.serviceName }}</td>
          <td class="px-6 py-2">{{ source.timeStamp | date: 'dd MMM yyyy, hh:mm a' }}</td>

          <td class="px-6 py-4 text-center">
            <button 
              (click)="addLeadFromSource(source)" 
              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm shadow-md transition duration-150"
            >
              Add
            </button>
          </td>

        </tr>
      </tbody>

    </table>

    <!-- No Data -->
    <ng-template #noData>
      <div class="flex justify-center items-center py-8 text-gray-600 text-lg font-medium">
        No lead sources available to add.
      </div>
    </ng-template>

  </div>

</div>




<!-- Leads Table -->
 
<table class="w-full mt-4 text-sm text-gray-700 border border-gray-200">
  <thead class="bg-gray-100">
    <tr>
      <th class="p-2">Lead Name</th>
      <th class="p-2">Lead Email</th>
      <th class="p-2">Contact No</th>
      <th class="p-2">Company Name</th>
      <th class="p-2">Company Address</th>
      <th class="p-2">Source Type</th>
      <th class="p-2">Service Name</th>
      <th class="p-2">Date</th>
      <th class="p-2">Status</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let lead of leads">
      <td class="p-2">{{ lead.leadName }}</td>
      <td class="p-2">{{ lead.leadEmail }}</td>
      <td class="p-2">{{ lead.contactNo }}</td>
      <td class="p-2">{{ lead.companyName }}</td>
      <td class="p-2">{{ lead.companyAdd }}</td>
      <td class="p-2">{{ lead.sourceType }}</td>
      <td class="p-2">{{ lead.crmService.serviceName }}</td>
      <td class="p-2">{{ lead.timeDate }}</td>
    



      <td class="p-2">
        <div *ngIf="lead.leadStatus === 'NEW_LEAD'; else staticStatus">
          <select
            [(ngModel)]="lead.leadStatus"
            (change)="onStatusChange(lead)"
            class="appearance-none bg-blue-100 text-blue-800 border border-blue-300 px-2 py-1 rounded-md text-xs font-semibold shadow-sm focus:outline-none"
          >
            <option value="NEW_LEAD">NEW LEAD</option>
            <option value="QUALIFIED">QUALIFIED</option>
          </select>
        </div>
      
        <ng-template #staticStatus>
          <span
            class="inline-block px-2 py-1 rounded text-xs font-semibold"
            [ngClass]="getBadgeClass(lead.leadStatus)"
          >
            {{ lead.leadStatus }}
          </span>
        </ng-template>
      </td>
      
   

    </tr>
  </tbody>
</table>

<app-pagination></app-pagination>
